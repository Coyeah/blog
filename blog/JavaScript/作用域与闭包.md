| 题目         | 创建时间            | 标签       |
| ------------ | ------------------- | ---------- |
| 作用域与闭包 | 2018-05-01 22:40:41 | JavaScript |

------

## 作用域

> 作用域是一套规矩，用于确定何处以及如何查找变量（标识符）。

在JavaScript中，作用域的界定是由变量决定的。

```JavaScript
var A = "Tony";  // 全局变量

function f1() {
  A = "Tony";  // 还是全局变量
  var B = "Ben";  // 局部变量
}
console.log(A);  // Tony
console.log(B);  // Uncaught ReferenceError: B is not defined
```

在函数中用var定义变量，则为局部变量，在其函数范围内调用是会报错的。因此，f1就是B的作用域。

## 作用域链

当代码在一个环境执行的时候，就会创建一个作用域链。为了保证对执行执行环境有权访问的所有变量和函数的有序访问。

简单地理解，其实和原型链是差不多的。不断向上一个环境寻找变量或函数是否存在。

```JavaScript
var text1 = "Just a test.";

function f1() {
  // 在f1函数中没有找到定义text1的变量，跑到全局执行环境去找。
  console.log(text1);  // Just a test
  
  // 在f1函数中找到了定义text2的变量。
  var text2 = "Test again."
  console.log(text2);  // Test again.
}
```

全局执行环境始终是作用域链的最后一层。

## 闭包

对闭包的理解：[闭包的理解](https://coyeah.top/2018/04/13/%E9%97%AD%E5%8C%85%E7%9A%84%E7%90%86%E8%A7%A3/)

```JavaScript
function f1() {
  var name = "coyeah";
  
  function f2() {
    console.log(name);
  }

  return f2;
}

var f3 = f1();

f3();  // coyeah.
```

### 内存泄漏

由于闭包的使用不会被垃圾回收机制清除，出现的问题就是让闭包中的变量会长期保存在内存中，过多的闭包会导致内存消耗很大，出现性能上的问题，在IE中可能会导致内存泄漏。

解决方法，在退出函数之前，把不使用的局部变量清除。

```JavaScript
function f1() {
  var e = document.getElementById('id');
  var id = e.id;

  e.onclick = function() {
    alert(id);
  }

  e = null; // 删除不使用的局部变量值，只将需要的 id 保存为副本
}
```
