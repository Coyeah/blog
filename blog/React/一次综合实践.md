| 题目         | 创建时间            | 标签       |
| ------------ | ------------------- | ---------- |
| 一次综合实践 | 2018-07-10 21:07:59 | React/前端 |

------

# 货币系统

第一次拿到一个如此完整的任务，又能有一位有经验的“师兄”带领和指导, 非常Lucky！试一次大幅拉高自己的机会，要做到完美，还得有个复盘。

## 前端部分

在我的提议之下，决定使用了Ant Design Pro，当着手做的时候才发现，完全是在给自己挖坑！中间有很多都是不懂没接触过的知识点。还是很兴奋的，在尝试开发antd pro的时候，逐个逐个击破它的技术栈，虽然很头疼，但是学到了很多东西。

### react-router

入手第一步，路由问题。react-router主要解决的是URL路径问题。寻常的网站上，点击一个超链接，除了找到相应位置的文件显示以外，URL也会做出相应的变化。例如：[http://www.coyeah.top/archives/](http://www.coyeah.top/archives/)。

而在React中，组件的更换和跳转是不会造成URL的变化。react-router的主要目的是让UI从URL中解耦出来，即UI变换伴随着URL的变化。提高用户体验，还能“精准定位”。

关键用法：`<Route path="/" component={...} />`

*注意：*react-router v4的用法不同了，引入的库变成了react-router-dom，具体用法可以参考[简明React Router v4教程](https://juejin.im/post/5a7e9ee7f265da4e7832949c)

[Github实践地址](https://github.com/Coyeah/react-primer/tree/master/demo11)

### redux

很早就接触过redux，但是现在碰起来，又有新的学习。

Redux中关键的`aciton`、`store`、`reducer`。用自己的话捋清当中的关系（纯属个人理解）。

* action是一个指令，这个指令是通过dispatch想store发布的。
* store是一个数据源，接收到action然后把指令给reducer命令指定的方法进行执行。
* Reducer是一个执行者，接收到action指令后找到指定的方法执行修改state后返回store。

Redux Flow：

![reduxFlow.jpg](https://www.coyeah.top/source/reduxFlow.jpg)

[Github实践地址](https://github.com/Coyeah/react-primer/tree/master/demo10)

### redux-saga

一个redux的中间件，涉及了JavaScript生成器。而当中一个名词：副作用，在主要作用（action触发reducer）之外，用来处理其他业务逻辑。受中文的影响，总觉得副作用是什么不好的东西。

常用的两种产生副作用的方式：

* takeEvery: 会在接到相应的action之后不断产生新的副作用。
* takeLates: 在相同额action被触发多次后，只会执行最后一次，其他的都会被取消。

call方法：有些类似Javascript中的call函数，不同的是它可以接受一个返回promise的函数，使用生成器的方式来把异步变同步。

put方法：put就是redux的dispatch，用来触发reducer更新store。

**对于中间件的异步操作，个人理解**

```JavaScript
componentDidMount() {
  const { dispatch } = this.props
  dispatch(fetchPosts(data));
}
```
action是一个字符串的标签，告诉reducer需要进行什么操作。而在异步操作中，action传入了一个方法，该方法中还会有一个`dispatch(action)`在异步的回调函数中。

[Github实践地址](https://github.com/Coyeah/react-primer/tree/master/demo13)

### axios

基于Promise的http库，适用于浏览器和node.js。

### dva

dva是基于现有应用架构 (redux + react-router + redux-saga 等)的一层轻量封装，前面的学习都是为了理解这个而准备的。

参考资料：

* [dvajs](https://dvajs.com/)
* [dva 源码解读](https://zhuanlan.zhihu.com/p/33783444)
* [dva-loading 实践用法](https://www.jianshu.com/p/61fe7a57fad4)
* [dva + antd + mockjs 实现用户管理](https://juejin.im/post/5a3b22246fb9a045023bcd12)
* [umi + dva，完成用户管理的 CURD 应用](https://github.com/sorrycc/blog/issues/62)

[Github实践地址](https://github.com/Coyeah/react-primer/tree/master/demo15)

### ant-design-pro

[antdpro-从百思不解到豁然开朗](http://www.coyeah.top/2018/07/19/antdpro-%E4%BB%8E%E7%99%BE%E6%80%9D%E4%B8%8D%E8%A7%A3%E5%88%B0%E8%B1%81%E7%84%B6%E5%BC%80%E6%9C%97/)

## 后端部分

### WebSocket

WebSocket协议区别于HTTP是允许服务器主动向客户端推送的。属于一种双向通信的协议。

主要特点：

* 建立在TCP协议之上，服务端的实现容易。
* 与HTTP协议有良好的兼容性。
* 数据格式比较轻量，性能开销小，通信高效。
* 可以发送文本，也可以发送二进制数据。
* 没有同源限制，客户端可以与任意服务器通信。
* 协议标识符为ws（加密为wss），服务器网址就是URL。

简单使用：

```JavaScript
const WebSocket = require('ws');
// WebSocket 对象作为一个构造函数，用于新建 WebSocket 实例。
const ws = new WebSocket(url);
// 连接并开启WebSocket通信。
ws.on('open', () => {
  console.log('open');
  // do something
})
// 通过WebSocket连接向服务器发送数据。
ws.on('message', () => {
  console.log('message');
  // do something
})
// 关闭WebSocket连接或停止正在进行的连接请求。
ws.on('close', () => {
  console.log('close');
  // do something
})
// 抛出异常的情况。
ws.on('error', () => {
  console.log('error');
  // do something
})
```

参考资料：

* [WebSocket 教程](http://www.ruanyifeng.com/blog/2017/05/websocket.html)

## 算法部分

### 配置策略

要面对对象开发，从对象中获取数据，在对已有的数据进行指定Rule来计算判断是对一种货币进行买入、卖出或者补仓，类似股票一样的操作。对每一次价格计算得出跌幅/涨幅。

因为涉及到多响应，一开始“师兄”推荐用`有限状态机`，可是在开发的时候发现，有限状态机只是正对一个状态的改变再进行不同状态的操作变化。而实际情况是不断的有新的数据进入再计算的，而在新数据进入的时候又会同时有多个状态判断是否符合条件，因此不符合实际需求。多得以前在学设计模式的时候有所记录，翻看了Github，就决定使用`观察者模式`。

[观察者模式（发布-订阅者模式）](https://github.com/Coyeah/js-primer#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E5%8F%91%E5%B8%83-%E8%AE%A2%E9%98%85%E8%80%85%E6%A8%A1%E5%BC%8F)


## 关于电子货币交易系统

电子货币交易系统，实际项目里也叫炒币机器人。前者听起来更加高大上吧。主要就是对一种货币的当前价值进行获取，然后在判断其跌幅/涨幅来进行买卖。有点类似于炒股票。由使用者设定配置策略，其中包括买入跌幅及回调、卖出涨幅及回调、补仓跌幅及回调、暴涨策略、补仓策略等对一/多种货币对进行监测。

第一次觉得程序是可以那么厉害，感觉以后炒股票都可以这样玩。
