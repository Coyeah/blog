| 题目                                  | 创建时间            | 标签                   |
| ------------------------------------- | ------------------- | ---------------------- |
| 阿里第二记-2018年秋季前端应届在线评测 | 2018-07-16 22:28:08 | 笔试题/JavaScript/前端 |

---

时隔四个月，也等待了四个月，秋招又来了。对上一次感觉是因为误操作所以没等来电话，学生时期的最后一次机会了。

还是30min的评测！

> 题目：实现mergePromise函数，把传进去的数组顺序先后执行，并且把返回的数据先后放到数组（data）中。

恰恰下午在车上复习了一下Promise，内心暗喜。

```JavaScript
const timeout = ms => new Promise((resolve, reject) => {
  setTimeout(() => {
    resolve();
  }, ms);
});

const ajax1 = () => timeout(2000).then(() => {
  console.log('1');
  return 1;
});

const ajax2 = () => timeout(1000).then(() => {
  console.log('2');
  return 2;
});

const ajax3 = () => timeout(2000).then(() => {
  console.log('3');
  return 3;
});

const mergePromise = ajaxArray => {
  // 在这里实现你的代码
};

mergePromise([ajax1, ajax2, ajax3]).then(data => {
  console.log('done');
  console.log(data);
});
```

纠结了好久写下了答案，一开始是能想到`mergePromise`是需要返回一个`Promise`才能使用`.then`，结果一紧张到后期居然忘了，因为在想着怎么实现顺序出结果的问题。悔呀！

## 铺上代码

```JavaScript
return new Promise((resolve, reject) => {  // <---就是把这个忘记了！
  let arr = ajaxArray;
  let ary = [];

  key();

  function key() {
    let tmp = new Promise((resolve, reject) => {
      arr[ary.length]().then((data) => {
        ary.push(data);
        resolve();
      })
    });

    tmp.then(() => {
      if (ary.length < arr.length) {
        key();
      } else {
        resolve(ary);
      }
    });
  }
});
```
---

2018-07-17

代码升级，用`async/await`显得更加高级！

```JavaScript
async function doSomething(ajaxArray) {
  let ary = [];
  let arr = ajaxArray;

  for (let i = 0; i < ajaxArray.length; i++) {
    let tmp = await arr[i]();
    ary.push(tmp);
  }

  return await ary;
}

return doSomething(ajaxArray);
```

`async/await`是Generator生成器的一种语法糖。而Generator侧重于让异步代码保持了顺序、同步、阻塞的代码模式，而async函数的实现，就是将Generator函数和自动执行器，包装在一个函数里，优势在于处理then链。

参考资料：[async函数的含义和用法](http://www.ruanyifeng.com/blog/2015/05/async.html)

---

2018-07-18

```JavaScirpt
let arr = ajaxArray;
return Promise.all([arr[0](), arr[1](), arr[2]()]).then(function (ary) {
  return ary;
})
```

每天都有新收获呀。今天把Promise的章节一看，发现`Promise.all`是具有数组顺序的功能的，这样写得出来的结果是不符合题目要求，不过也算是一种拓展。